---
phase: 06-generateform-integration
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - frontend/src/api/types.ts
  - frontend/src/api/client.ts
  - frontend/src/components/ManifestSelector.tsx
  - frontend/src/components/ManifestCard.tsx
  - frontend/src/components/GenerateForm.tsx
autonomous: true

must_haves:
  truths:
    - "GenerateForm shows manifest selector section with radio toggle between Select Existing and Quick Upload"
    - "Selecting existing manifest mode shows grid of READY manifests for selection"
    - "Selecting a manifest shows preview card with name, asset count, category, status, and key asset thumbnails"
    - "Quick Upload mode shows existing inline upload behavior (placeholder for now since upload UI not yet built)"
    - "Submitting form with selected manifest sends manifest_id to POST /api/generate"
    - "Submitting form without manifest works exactly as before"
    - "ManifestCard can render in compact mode (no action buttons) for use in selector"
  artifacts:
    - path: "frontend/src/components/ManifestSelector.tsx"
      provides: "ManifestSelector component with radio toggle and manifest grid/preview"
      contains: "ManifestSelector"
    - path: "frontend/src/components/GenerateForm.tsx"
      provides: "GenerateForm with ManifestSelector integration"
      contains: "ManifestSelector"
    - path: "frontend/src/api/types.ts"
      provides: "Updated GenerateRequest with manifest_id field"
      contains: "manifest_id"
    - path: "frontend/src/components/ManifestCard.tsx"
      provides: "ManifestCard with optional compact mode"
      contains: "compact"
  key_links:
    - from: "frontend/src/components/GenerateForm.tsx"
      to: "frontend/src/components/ManifestSelector.tsx"
      via: "ManifestSelector component usage"
      pattern: "<ManifestSelector"
    - from: "frontend/src/components/GenerateForm.tsx"
      to: "frontend/src/api/client.ts"
      via: "generateVideo call with manifest_id in payload"
      pattern: "manifest_id.*selectedManifestId"
    - from: "frontend/src/components/ManifestSelector.tsx"
      to: "frontend/src/api/client.ts"
      via: "listManifests and getManifestDetail calls"
      pattern: "listManifests|getManifestDetail"
---

<objective>
Create ManifestSelector component and integrate it into GenerateForm so users can select an existing manifest or choose quick upload when generating a video.

Purpose: Users gain the ability to reuse pre-built manifests during video generation, completing the bridge between the Manifest Library (Phase 4-5) and the generation pipeline.
Output: Frontend manifest selection UI in GenerateForm.
</objective>

<execution_context>
@/home/ubuntu/.claude/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@frontend/src/components/GenerateForm.tsx
@frontend/src/components/ManifestCard.tsx
@frontend/src/api/types.ts
@frontend/src/api/client.ts
@.planning/phases/06-generateform-integration/06-01-SUMMARY.md
@.planning/phases/06-generateform-integration/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update types, client, and add compact ManifestCard mode</name>
  <files>
    frontend/src/api/types.ts
    frontend/src/api/client.ts
    frontend/src/components/ManifestCard.tsx
  </files>
  <action>
1. In `frontend/src/api/types.ts`:
   - Add `manifest_id?: string;` to the GenerateRequest interface (optional field, after enable_audio)

2. In `frontend/src/api/client.ts`:
   - No changes needed — the generateVideo function already sends the full body object to the API, so adding manifest_id to GenerateRequest type automatically includes it when provided

3. In `frontend/src/components/ManifestCard.tsx`:
   - Add a `compact` boolean prop (default false) to ManifestCardProps
   - Make the action button callbacks optional: `onEdit?: (id: string) => void` etc.
   - When compact=true:
     - Hide the footer with action buttons entirely (don't render the border-t div)
     - Reduce padding to p-3 (from p-4)
     - Make text sizes smaller: name h3 text-base (from text-lg), description text-xs (from text-sm)
     - Hide tags section
     - Add asset type breakdown summary if possible (show "3 chars, 2 envs" style from metadata)
   - When compact=false: render exactly as today (no visual regression)
   - The onClick on the outer div should still work (calls onView) but only if onView is provided
   - Export the component as before

   The compact card should look like a summary preview: name, status badge, category pill, asset count, and description truncated to 1 line.
  </action>
  <verify>
    - `cd /home/ubuntu/work/video-pipeline/frontend && npx tsc --noEmit` passes (TypeScript compiles without errors)
    - GenerateRequest type includes manifest_id as optional string
    - ManifestCard accepts compact prop without breaking existing ManifestLibrary usage
  </verify>
  <done>
    GenerateRequest has manifest_id. ManifestCard renders in compact mode (no actions, smaller text) and normal mode (unchanged from Phase 4). TypeScript compiles clean.
  </done>
</task>

<task type="auto">
  <name>Task 2: ManifestSelector component and GenerateForm integration</name>
  <files>
    frontend/src/components/ManifestSelector.tsx
    frontend/src/components/GenerateForm.tsx
  </files>
  <action>
1. Create `frontend/src/components/ManifestSelector.tsx`:

   Interface:
   ```typescript
   interface ManifestSelectorProps {
     selectedManifestId: string | null;
     onManifestSelect: (manifestId: string | null) => void;
   }
   ```

   Implementation:
   - State: `mode` ("existing" | "quick"), `manifests` (ManifestListItem[]), `loading` (boolean), `selectedDetail` (ManifestDetail | null)
   - On mount (useEffect), fetch manifests via `listManifests({ status: "READY", sort_by: "last_used_at", sort_order: "desc" })` — only show READY manifests (not DRAFT or PROCESSING). Note: the current listManifests API does NOT filter by status server-side (check routes.py — it does accept status param). Use status="READY" query param.
   - When selectedManifestId changes, fetch detail via `getManifestDetail(selectedManifestId)` and store in selectedDetail
   - When mode switches to "quick", clear selection: `onManifestSelect(null)`

   Render structure:
   ```
   <div className="space-y-4">
     {/* Radio toggle */}
     <div className="flex gap-4">
       <label> <input type="radio" checked={mode==="existing"} onChange=> Select Existing Manifest </label>
       <label> <input type="radio" checked={mode==="quick"} onChange=> Quick Upload (inline) </label>
     </div>

     {/* Content area */}
     {mode === "existing" ? (
       selectedDetail ? (
         // Selected manifest preview
         <div className="rounded-lg border border-blue-500/30 bg-blue-500/5 p-4">
           <div className="flex items-start justify-between">
             <div>
               <h4 className="font-semibold text-gray-100">{selectedDetail.name}</h4>
               <p className="text-sm text-gray-400">{selectedDetail.asset_count} assets | {selectedDetail.category} | v{selectedDetail.version}</p>
               {selectedDetail.description && <p className="mt-1 text-sm text-gray-500 line-clamp-2">{selectedDetail.description}</p>}
             </div>
             <StatusBadge status={selectedDetail.status} />
           </div>
           {/* Key asset thumbnails - show first 5 assets with images */}
           {selectedDetail.assets.length > 0 && (
             <div className="mt-3 flex gap-2 overflow-x-auto">
               {selectedDetail.assets.filter(a => a.reference_image_url).slice(0, 5).map(asset => (
                 <div key={asset.asset_id} className="flex-shrink-0">
                   <img src={asset.reference_image_url} alt={asset.name} className="h-12 w-12 rounded object-cover" />
                   <p className="mt-0.5 text-center text-[10px] text-gray-500">{asset.manifest_tag}</p>
                 </div>
               ))}
               {selectedDetail.assets.filter(a => a.reference_image_url).length > 5 && (
                 <span className="flex h-12 w-12 items-center justify-center rounded bg-gray-800 text-xs text-gray-400">
                   +{selectedDetail.assets.filter(a => a.reference_image_url).length - 5}
                 </span>
               )}
             </div>
           )}
           <button onClick={() => onManifestSelect(null)} className="mt-3 text-sm text-gray-400 hover:text-gray-300">
             Change Manifest
           </button>
         </div>
       ) : (
         // Manifest selection grid
         <div>
           {loading ? (
             <p className="text-sm text-gray-500">Loading manifests...</p>
           ) : manifests.length === 0 ? (
             <p className="text-sm text-gray-500">No ready manifests found. Create one in the Manifest Library first.</p>
           ) : (
             <div className="grid grid-cols-2 gap-3 max-h-64 overflow-y-auto">
               {manifests.slice(0, 6).map(m => (
                 <button key={m.manifest_id} onClick={() => onManifestSelect(m.manifest_id)} className="text-left">
                   <ManifestCard manifest={m} compact />
                 </button>
               ))}
             </div>
           )}
         </div>
       )
     ) : (
       // Quick Upload placeholder
       <div className="rounded-lg border border-dashed border-gray-700 bg-gray-900/50 p-6 text-center">
         <p className="text-sm text-gray-400">
           Upload reference images inline. An auto-manifest will be created behind the scenes.
         </p>
         <p className="mt-1 text-xs text-gray-600">
           (Upload UI coming in a future phase — for now, generate without a manifest)
         </p>
       </div>
     )}
   </div>
   ```

   Import StatusBadge from "./StatusBadge.tsx", ManifestCard from "./ManifestCard.tsx", listManifests and getManifestDetail from "../api/client.ts", types from "../api/types.ts".

   Style the radio buttons to match the existing form design: use the same pill-button pattern as style/aspect-ratio selectors rather than raw radio inputs. Use clsx for conditional styling:
   ```
   <button type="button" onClick={...} className={clsx(
     "rounded-md border px-3 py-1.5 text-sm font-medium transition-colors",
     mode === "existing"
       ? "border-blue-500 bg-blue-500/20 text-blue-300"
       : "border-gray-700 bg-gray-900 text-gray-400 hover:border-gray-600",
   )}>
     Select Existing
   </button>
   ```
   (Same pattern as style buttons in GenerateForm.)

2. In `frontend/src/components/GenerateForm.tsx`:

   a. Add state: `const [selectedManifestId, setSelectedManifestId] = useState<string | null>(null);`

   b. Add ManifestSelector section after the Audio toggle and before the Cost Estimate section:
   ```tsx
   {/* Asset Manifest */}
   <div>
     <label className="mb-2 block text-sm font-medium text-gray-300">
       Asset Manifest
     </label>
     <p className="mb-3 text-xs text-gray-500">
       Choose reference assets from a pre-built manifest or upload inline.
     </p>
     <ManifestSelector
       selectedManifestId={selectedManifestId}
       onManifestSelect={setSelectedManifestId}
     />
   </div>
   ```

   c. In handleSubmit, add manifest_id to the generateVideo payload:
   ```tsx
   const res = await generateVideo({
     prompt: prompt.trim(),
     style,
     aspect_ratio: aspectRatio,
     clip_duration: clipDuration,
     total_duration: totalDuration,
     text_model: textModel,
     image_model: imageModel,
     video_model: videoModel,
     enable_audio: audioActive,
     manifest_id: selectedManifestId ?? undefined,  // Only include if selected
   });
   ```
   Note: Use `?? undefined` (not `?? null`) so the field is omitted from JSON when not set, matching the backend's Optional[str] = None default.

   d. Import ManifestSelector: `import { ManifestSelector } from "./ManifestSelector.tsx";`
  </action>
  <verify>
    - `cd /home/ubuntu/work/video-pipeline/frontend && npx tsc --noEmit` passes
    - ManifestSelector.tsx exists and exports ManifestSelector component
    - GenerateForm.tsx imports and renders ManifestSelector
    - GenerateForm.tsx sends manifest_id in generateVideo payload when a manifest is selected
    - GenerateForm.tsx does NOT send manifest_id when no manifest is selected (backward compatible)
  </verify>
  <done>
    ManifestSelector component renders radio toggle between "Select Existing" and "Quick Upload". When "Select Existing" is active, shows grid of READY manifests. Clicking a manifest shows preview with name, assets, thumbnails, and "Change Manifest" button. GenerateForm integrates ManifestSelector and sends manifest_id to API when selected. Form works unchanged without manifest selection.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit`
2. Frontend dev build: `cd frontend && npx vite build` succeeds
3. GenerateForm renders with manifest selector section visible
4. Selecting a manifest shows preview with asset thumbnails
5. Submitting without manifest works as before (no regression)
6. Submitting with manifest includes manifest_id in request body
</verification>

<success_criteria>
- ManifestSelector component exists with radio toggle between "Select Existing Manifest" and "Quick Upload"
- Selecting existing mode shows grid of READY manifests from library
- Clicking a manifest shows preview card with name, status, asset count, category, and key asset thumbnails
- "Change Manifest" button allows re-selection
- Quick Upload mode shows placeholder messaging (full upload UI deferred)
- GenerateForm integrates ManifestSelector and passes manifest_id to API
- All TypeScript compiles clean
- No regression in GenerateForm behavior when manifest is not selected
</success_criteria>

<output>
After completion, create `.planning/phases/06-generateform-integration/06-02-SUMMARY.md`
</output>
