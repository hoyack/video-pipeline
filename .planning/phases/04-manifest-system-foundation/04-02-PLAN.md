---
phase: 04-manifest-system-foundation
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/src/api/types.ts
  - frontend/src/api/client.ts
  - frontend/src/components/ManifestLibrary.tsx
  - frontend/src/components/ManifestCard.tsx
  - frontend/src/components/Layout.tsx
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to Manifest Library from the top nav bar"
    - "User sees manifest cards in a responsive grid with name, status, category, asset count"
    - "User can filter manifests by category using filter buttons"
    - "User can sort manifests by date, name, times used, or asset count"
    - "User can click Edit, Duplicate, Delete, or View on a manifest card"
    - "Deleting a manifest shows confirmation and removes it from the list"
    - "Duplicate creates a copy and shows it in the library"
    - "New Manifest button navigates to the Manifest Creator"
  artifacts:
    - path: "frontend/src/api/types.ts"
      provides: "TypeScript interfaces for Manifest and Asset API contracts"
      contains: "ManifestListItem"
    - path: "frontend/src/api/client.ts"
      provides: "API client functions for manifest CRUD"
      contains: "listManifests"
    - path: "frontend/src/components/ManifestLibrary.tsx"
      provides: "Manifest Library view with filter, sort, and grid layout"
      contains: "ManifestLibrary"
    - path: "frontend/src/components/ManifestCard.tsx"
      provides: "Individual manifest card component with actions"
      contains: "ManifestCard"
    - path: "frontend/src/components/Layout.tsx"
      provides: "Updated nav with Manifests tab"
      contains: "manifests"
    - path: "frontend/src/App.tsx"
      provides: "Updated routing to include manifest views"
      contains: "ManifestLibrary"
  key_links:
    - from: "frontend/src/components/ManifestLibrary.tsx"
      to: "frontend/src/api/client.ts"
      via: "listManifests, deleteManifest, duplicateManifest calls"
      pattern: "listManifests"
    - from: "frontend/src/api/client.ts"
      to: "/api/manifests"
      via: "fetch requests to backend REST endpoints"
      pattern: "request.*\\/api\\/manifests"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/components/ManifestLibrary.tsx"
      via: "conditional rendering based on currentView"
      pattern: "ManifestLibrary"
---

<objective>
Build the Manifest Library frontend view and integrate it into the app navigation. Users can browse manifests in a filterable/sortable card grid, perform CRUD actions (edit, duplicate, delete), and navigate to the Manifest Creator.

Purpose: Provides the user-facing interface for managing manifests, making the backend CRUD endpoints accessible through an intuitive card-based library UI.

Output: ManifestLibrary.tsx, ManifestCard.tsx components, updated TypeScript types, API client functions, and navigation integration.
</objective>

<execution_context>
@/home/ubuntu/.claude/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-manifest-system-foundation/04-RESEARCH.md
@.planning/phases/04-manifest-system-foundation/04-01-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/components/Layout.tsx
@frontend/src/api/client.ts
@frontend/src/api/types.ts
@frontend/src/components/ProjectList.tsx
@frontend/src/components/StatusBadge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: TypeScript types, API client functions, and ManifestCard component</name>
  <files>
    frontend/src/api/types.ts
    frontend/src/api/client.ts
    frontend/src/components/ManifestCard.tsx
  </files>
  <action>
**Add to `frontend/src/api/types.ts`** — new interfaces matching the backend Pydantic schemas from Plan 01:

```typescript
/** Item in GET /api/manifests list */
export interface ManifestListItem {
  manifest_id: string;
  name: string;
  description: string | null;
  thumbnail_url: string | null;
  category: string;
  tags: string[] | null;
  status: string;
  asset_count: number;
  times_used: number;
  last_used_at: string | null;
  version: number;
  created_at: string;
  updated_at: string;
}

/** Response from GET /api/manifests/{id} */
export interface ManifestDetail {
  manifest_id: string;
  name: string;
  description: string | null;
  thumbnail_url: string | null;
  category: string;
  tags: string[] | null;
  status: string;
  processing_progress: Record<string, unknown> | null;
  contact_sheet_url: string | null;
  asset_count: number;
  total_processing_cost: number;
  times_used: number;
  last_used_at: string | null;
  version: number;
  parent_manifest_id: string | null;
  created_at: string;
  updated_at: string;
  assets: AssetResponse[];
}

/** Asset within a manifest */
export interface AssetResponse {
  asset_id: string;
  manifest_id: string;
  asset_type: string;
  name: string;
  manifest_tag: string;
  user_tags: string[] | null;
  reference_image_url: string | null;
  thumbnail_url: string | null;
  description: string | null;
  source: string;
  sort_order: number;
  created_at: string;
}

/** Request body for POST /api/manifests */
export interface CreateManifestRequest {
  name: string;
  description?: string;
  category?: string;
  tags?: string[];
}

/** Request body for PUT /api/manifests/{id} */
export interface UpdateManifestRequest {
  name?: string;
  description?: string;
  category?: string;
  tags?: string[];
}

/** Request body for POST /api/manifests/{id}/assets */
export interface CreateAssetRequest {
  name: string;
  asset_type: string;
  description?: string;
  user_tags?: string[];
}

/** Request body for PUT /api/assets/{id} */
export interface UpdateAssetRequest {
  name?: string;
  description?: string;
  asset_type?: string;
  user_tags?: string[];
  sort_order?: number;
}
```

Note: Use `number` not `int` for TypeScript (fix the `version: int` to `version: number`).

IMPORTANT: All 7 interfaces above must be added to types.ts. In particular, `UpdateAssetRequest` is required by Plan 04-03 (client.ts updateAsset function). Do not omit it.

**Add to `frontend/src/api/client.ts`** — new API functions after existing exports:

```typescript
/** GET /api/manifests — list manifests with optional filters */
export function listManifests(params?: {
  category?: string;
  sort_by?: string;
  sort_order?: string;
}): Promise<ManifestListItem[]> {
  const searchParams = new URLSearchParams();
  if (params?.category) searchParams.set("category", params.category);
  if (params?.sort_by) searchParams.set("sort_by", params.sort_by);
  if (params?.sort_order) searchParams.set("sort_order", params.sort_order);
  const qs = searchParams.toString();
  return request<ManifestListItem[]>(`/api/manifests${qs ? `?${qs}` : ""}`);
}

/** POST /api/manifests — create new manifest */
export function createManifest(body: CreateManifestRequest): Promise<ManifestListItem> {
  return request<ManifestListItem>("/api/manifests", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body),
  });
}

/** GET /api/manifests/{id} — get manifest with assets */
export function getManifestDetail(manifestId: string): Promise<ManifestDetail> {
  return request<ManifestDetail>(`/api/manifests/${manifestId}`);
}

/** PUT /api/manifests/{id} — update manifest */
export function updateManifest(manifestId: string, body: UpdateManifestRequest): Promise<ManifestListItem> {
  return request<ManifestListItem>(`/api/manifests/${manifestId}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body),
  });
}

/** DELETE /api/manifests/{id} — soft delete manifest */
export function deleteManifest(manifestId: string): Promise<{ status: string; manifest_id: string }> {
  return request<{ status: string; manifest_id: string }>(`/api/manifests/${manifestId}`, {
    method: "DELETE",
  });
}

/** POST /api/manifests/{id}/duplicate — duplicate manifest */
export function duplicateManifest(manifestId: string, name?: string): Promise<ManifestListItem> {
  const qs = name ? `?name=${encodeURIComponent(name)}` : "";
  return request<ManifestListItem>(`/api/manifests/${manifestId}/duplicate${qs}`, {
    method: "POST",
  });
}
```

Import the new types at the top of client.ts alongside existing imports.

**Create `frontend/src/components/ManifestCard.tsx`** — card component for the library grid:

Follow the dark theme from existing components (gray-900 backgrounds, gray-200/400 text, blue-400/500 accents). Match the visual style of ProjectList.tsx but as cards instead of table rows.

Component props interface:
```typescript
interface ManifestCardProps {
  manifest: ManifestListItem;
  onEdit: (id: string) => void;
  onView: (id: string) => void;
  onDuplicate: (id: string) => void;
  onDelete: (id: string) => void;
}
```

Card layout (vertical):
1. **Header row**: Name (font-semibold, text-lg, text-gray-100, truncate) + StatusBadge on the right (reuse existing StatusBadge component — it works with any status string)
2. **Description**: 2-line truncated text (text-sm text-gray-400, line-clamp-2). Show "No description" in italic gray-600 if null.
3. **Metadata row**: Category pill (text-xs rounded bg-gray-800 px-2 py-0.5 text-gray-300) + Asset count ("N assets" text-xs text-gray-500) + Version badge if > 1 ("v{N}" text-xs)
4. **Tags**: If tags exist, show first 3 as small pills (text-xs bg-gray-800/50 rounded px-1.5 py-0.5 text-gray-400), then "+N more" if overflow
5. **Footer row**: Horizontal divider (border-t border-gray-800 mt-3 pt-3) then action buttons:
   - "View" (text-sm text-blue-400 hover:text-blue-300)
   - "Edit" (text-sm text-blue-400 hover:text-blue-300)
   - "Duplicate" (text-sm text-gray-400 hover:text-gray-300)
   - "Delete" (text-sm text-red-400 hover:text-red-300)
   - Buttons in a flex row with gap-3

Card container: `rounded-lg border border-gray-800 bg-gray-900/50 p-4 hover:border-gray-700 transition-colors cursor-pointer`

Clicking the card body (not buttons) calls `onView`.

Use `e.stopPropagation()` on action buttons to prevent card click handler.

Import StatusBadge from "./StatusBadge.tsx" (it already handles arbitrary status strings).
  </action>
  <verify>
Run `cd /home/ubuntu/work/video-pipeline/frontend && npx tsc --noEmit` to verify TypeScript compilation succeeds with no type errors. Check that ManifestCard.tsx, types.ts, and client.ts all compile cleanly.
  </verify>
  <done>
TypeScript types match backend API contract — all 7 interfaces defined (ManifestListItem, ManifestDetail, AssetResponse, CreateManifestRequest, UpdateManifestRequest, CreateAssetRequest, UpdateAssetRequest). API client has 6 manifest functions (list, create, getDetail, update, delete, duplicate). ManifestCard component renders manifest data with dark theme styling matching existing UI. All files pass TypeScript strict mode compilation.
  </done>
</task>

<task type="auto">
  <name>Task 2: ManifestLibrary view with filters/sort and app navigation integration</name>
  <files>
    frontend/src/components/ManifestLibrary.tsx
    frontend/src/components/Layout.tsx
    frontend/src/App.tsx
  </files>
  <action>
**Create `frontend/src/components/ManifestLibrary.tsx`** — main library view:

Follow the same hook-based data fetching pattern as ProjectList.tsx (useState + useCallback + useEffect).

State:
- `manifests: ManifestListItem[]` — loaded from API
- `loading: boolean` — initial load state
- `error: string | null` — error message
- `categoryFilter: string` — "ALL" | "CHARACTERS" | "ENVIRONMENT" | "FULL_PRODUCTION" | "STYLE_KIT" | "BRAND_KIT" | "CUSTOM"
- `sortBy: string` — "updated_at" | "created_at" | "name" | "times_used" | "asset_count"
- `sortOrder: string` — "desc" | "asc"
- `deleteConfirm: string | null` — manifest_id pending delete confirmation

Fetch function: Call `listManifests({ category: categoryFilter !== "ALL" ? categoryFilter : undefined, sort_by: sortBy, sort_order: sortOrder })`. Re-fetch when categoryFilter, sortBy, or sortOrder change (include in useEffect dependency array).

Layout:
1. **Header section** (flex justify-between items-center mb-6):
   - Left: `<h1 className="text-2xl font-bold text-white">Manifest Library</h1>`
   - Right: `<button className="rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-500 transition-colors">+ New Manifest</button>` — calls `onCreateNew()`

2. **Filter/Sort bar** (flex items-center gap-4 mb-6):
   - Category filter pills: Row of buttons for each category. Active pill: `bg-gray-700 text-white`, inactive: `bg-gray-900 text-gray-400 hover:text-gray-300 border border-gray-800`. Include "All" as first option.
   - Sort dropdown: `<select>` with options for sort_by (Updated, Created, Name, Most Used, Most Assets). Style: `bg-gray-900 border border-gray-800 rounded text-sm text-gray-300 px-2 py-1.5`
   - Sort direction toggle button: arrow up/down icon (use unicode arrows or simple text "Asc"/"Desc")

3. **Results summary** (text-sm text-gray-500 mb-4): "{N} manifest(s)"

4. **Card grid** (grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4):
   - Map over manifests, render ManifestCard for each
   - Pass handlers: onEdit, onView, onDuplicate, onDelete

5. **Empty state** (when manifests.length === 0 and not loading):
   - Centered text: "No manifests yet."
   - Subtitle: "Create your first manifest to start building reusable asset collections."
   - CTA button that calls onCreateNew()

6. **Delete confirmation** — when deleteConfirm is set, show a simple overlay/modal:
   - Semi-transparent backdrop (fixed inset-0 bg-black/50 flex items-center justify-center z-50)
   - Modal box (bg-gray-900 border border-gray-800 rounded-lg p-6 max-w-sm)
   - Text: "Delete this manifest? This action can be undone."
   - Two buttons: "Cancel" (text-gray-400) and "Delete" (bg-red-600 text-white)
   - On confirm: call `deleteManifest(deleteConfirm)`, then remove from local state, clear deleteConfirm
   - On error: show error message, keep modal open

7. **Duplicate handler**: call `duplicateManifest(id)`, then prepend result to manifests list

Loading state: Spinner or "Loading manifests..." centered text (match ProjectList pattern).
Error state: Error message + Retry button (match ProjectList pattern).

Props interface:
```typescript
interface ManifestLibraryProps {
  onCreateNew: () => void;
  onEditManifest: (manifestId: string) => void;
  onViewManifest: (manifestId: string) => void;
}
```

**Update `frontend/src/components/Layout.tsx`**:
- Add "manifests" to the View type: `export type View = "generate" | "progress" | "list" | "detail" | "dashboard" | "manifests" | "manifest-creator";`
- Add "Manifests" to NAV_ITEMS array: `{ view: "manifests" as View, label: "Manifests" }` — insert after "Projects" and before "Dashboard"

**Update `frontend/src/App.tsx`**:
- Import ManifestLibrary: `import { ManifestLibrary } from "./components/ManifestLibrary.tsx";`
- Add state for activeManifestId: `const [activeManifestId, setActiveManifestId] = useState<string | null>(null);`
- Add handler functions:
  ```typescript
  function handleCreateManifest() {
    navigateTo("manifest-creator");
  }
  function handleEditManifest(manifestId: string) {
    setActiveManifestId(manifestId);
    navigateTo("manifest-creator");
  }
  function handleViewManifest(manifestId: string) {
    setActiveManifestId(manifestId);
    navigateTo("manifest-creator");  // View opens creator in read mode for now
  }
  ```
- Add conditional render block for manifests view:
  ```tsx
  {currentView === "manifests" && (
    <ManifestLibrary
      onCreateNew={handleCreateManifest}
      onEditManifest={handleEditManifest}
      onViewManifest={handleViewManifest}
    />
  )}
  ```
- Add placeholder for manifest-creator view (to be implemented in Plan 03):
  ```tsx
  {currentView === "manifest-creator" && (
    <div className="py-12 text-center text-gray-500">
      <p className="text-lg font-medium">Manifest Creator</p>
      <p className="mt-2 text-sm">Coming in Plan 04-03</p>
      <button
        onClick={() => navigateTo("manifests")}
        className="mt-4 text-sm text-blue-400 hover:text-blue-300"
      >
        Back to Library
      </button>
    </div>
  )}
  ```
  </action>
  <verify>
1. Run `cd /home/ubuntu/work/video-pipeline/frontend && npx tsc --noEmit` to verify no TypeScript errors.
2. Run `cd /home/ubuntu/work/video-pipeline/frontend && npm run build` to verify production build succeeds.
3. Visual check: Start the dev server (`npm run dev`) and backend (`python -m vidpipe.api`), navigate to Manifests tab. Verify:
   - Library loads (may be empty)
   - Category filter pills render and are clickable
   - Sort dropdown works
   - "+ New Manifest" button is visible
   - If manifests exist: cards display in 3-column grid on desktop
  </verify>
  <done>
ManifestLibrary view renders a responsive card grid with category filter pills, sort controls, and action buttons. ManifestCard displays name, status badge, description, category, asset count, tags, and action buttons (View, Edit, Duplicate, Delete). Delete shows confirmation modal. Duplicate adds copy to the list. Navigation integrated with "Manifests" tab in the top nav. Manifest Creator view has a placeholder. All TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. TypeScript: `npx tsc --noEmit` passes with zero errors
2. Build: `npm run build` produces dist/ without errors
3. Navigation: "Manifests" tab visible in nav bar, clicking navigates to library
4. Empty state: Shows "No manifests yet" with create button when no manifests exist
5. Card grid: After creating manifests via API, cards appear in 3-column responsive grid
6. Category filter: Clicking a category pill filters the list (only matching manifests shown)
7. Sort: Changing sort dropdown reorders manifests
8. Actions: Delete shows confirmation, Duplicate creates copy, Edit/View navigate to creator
9. Dark theme: All new components match existing gray-900/800 dark theme
</verification>

<success_criteria>
- ManifestLibrary renders manifest cards with all required data (name, status, category, asset count, tags)
- Category filter pills work (ALL + 6 categories)
- Sort controls work (5 sort options + asc/desc)
- Card actions: Edit, Duplicate, Delete, View all functional
- Delete confirmation modal prevents accidental deletion
- Duplicate immediately shows new manifest in library
- Navigation: "Manifests" tab in nav, routes to library view
- Dark theme consistent with existing UI
</success_criteria>

<output>
After completion, create `.planning/phases/04-manifest-system-foundation/04-02-SUMMARY.md`
</output>